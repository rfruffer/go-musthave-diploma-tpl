# üõí Gophermart ‚Äî –¥–∏–ø–ª–æ–º–Ω—ã–π –ø—Ä–æ–µ–∫—Ç Go-—Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞

Gophermart ‚Äî —ç—Ç–æ —Å–∏—Å—Ç–µ–º–∞ –Ω–∞–∫–æ–ø–ª–µ–Ω–∏—è –∏ —Å–ø–∏—Å–∞–Ω–∏—è –±–∞–ª–ª–æ–≤, —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–Ω–Ω–∞—è –≤ —Ä–∞–º–∫–∞—Ö –¥–∏–ø–ª–æ–º–Ω–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞ –∫—É—Ä—Å–∞ "Go-—Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫".

---

## üöÄ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∏ –ª–æ–≥–∏–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π  
- –ü—Ä–∏–µ–º –Ω–æ–º–µ—Ä–æ–≤ –∑–∞–∫–∞–∑–æ–≤ –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ –∞–ª–≥–æ—Ä–∏—Ç–º—É –õ—É–Ω–∞  
- –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –≤–Ω–µ—à–Ω–∏–º —Å–µ—Ä–≤–∏—Å–æ–º Accrual  
- –ë–∞–ª–∞–Ω—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –∏—Å—Ç–æ—Ä–∏—è —Å–ø–∏—Å–∞–Ω–∏–π  
- –í—ã–≤–æ–¥ —Å—Ä–µ–¥—Å—Ç–≤ –∏ –ø—Ä–æ—Å–º–æ—Ç—Ä –∏—Å—Ç–æ—Ä–∏–∏ –≤—ã–≤–æ–¥–æ–≤  
- –†–∞–±–æ—Ç–∞ —Å PostgreSQL  
- Cookie-based –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —Å HMAC-–ø–æ–¥–ø–∏—Å—å—é  
- –û—á–µ—Ä–µ–¥—å –∑–∞–∫–∞–∑–æ–≤ –∏ —Ñ–æ–Ω–æ–≤—ã–π –≤–æ—Ä–∫–µ—Ä  

---

## üß± –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

- **Go 1.21+**  
- **Gin** ‚Äî –≤–µ–±-—Ñ—Ä–µ–π–º–≤–æ—Ä–∫  
- **PostgreSQL 13**  
- **Docker / Docker Compose**  
- **bcrypt**, **UUID**, **pgx**  

---

## üìÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```bash
cmd/gophermart/           # —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞: main.go
‚îÇ
‚îú‚îÄ‚îÄ config/               # –ø–∞—Ä—Å–∏–Ω–≥ —Ñ–ª–∞–≥–æ–≤ –∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ internal/
‚îÇ   ‚îú‚îÄ‚îÄ handlers/         # HTTP-–æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ (Gin)
‚îÇ   ‚îú‚îÄ‚îÄ repository/       # –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –¥–æ—Å—Ç—É–ø–∞ –∫ –ë–î
‚îÇ   ‚îú‚îÄ‚îÄ services/         # –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
‚îÇ   ‚îú‚îÄ‚îÄ async/            # –≤–æ—Ä–∫–µ—Ä –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–∫–∞–∑–æ–≤ —á–µ—Ä–µ–∑ Accrual
‚îÇ   ‚îú‚îÄ‚îÄ models/           # —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îú‚îÄ‚îÄ middlewares/      # middleware –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
‚îú‚îÄ‚îÄ router/               # –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –º–∞—Ä—à—Ä—É—Ç–æ–≤ –∏ middleware
```

---

## ‚öôÔ∏è –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–ó–∞–¥–∞—é—Ç—Å—è –≤ `docker-compose.yml`:

```
DATABASE_DSN=postgres://user:password@db:5432/workdb?sslmode=disable  
ACCRUAL_SYSTEM_ADDRESS=http://host.docker.internal:8080
```

–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –ø–æ—Ä—Ç API: **8081**

---

## üê≥ –ö–∞–∫ –∑–∞–ø—É—Å—Ç–∏—Ç—å

1. –ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ –ø—Ä–æ–µ–∫—Ç:

```bash
git clone https://github.com/rfruffer/go-musthave-diploma-tpl.git
cd go-musthave-diploma-tpl
```

2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∏–º—É–ª—è—Ç–æ—Ä Accrual (–∑–∞–º–µ–Ω–∏—Ç–µ –±–∏–Ω–∞—Ä–Ω–∏–∫ –ø–æ–¥ –≤–∞—à—É –û–°):

```bash
./accrual_darwin_arm64 -a localhost:8080
```

3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ Gophermart –∏ PostgreSQL —á–µ—Ä–µ–∑ Docker:

```bash
docker-compose up --build
```

- Gophermart API –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ –∞–¥—Ä–µ—Å—É: `http://localhost:8081`  
- PostgreSQL –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –Ω–∞ `localhost:5432`

---

## üîê –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è

- –ü—Ä–∏ –ª–æ–≥–∏–Ω–µ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è cookie —Å `user_id`, –ø–æ–¥–ø–∏—Å–∞–Ω–Ω–∞—è `SECRET_KEY`  
- –í—Å–µ –∑–∞—â–∏—â–µ–Ω–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –ø—Ä–æ–≤–µ—Ä—è—é—Ç –ø–æ–¥–ø–∏—Å—å –∏ –Ω–∞–ª–∏—á–∏–µ –∫—É–∫–∏ —á–µ—Ä–µ–∑ middleware

---

## üì¨ –û—Å–Ω–æ–≤–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã

| –ú–µ—Ç–æ–¥ | –ü—É—Ç—å                          | –û–ø–∏—Å–∞–Ω–∏–µ                     |
|-------|-------------------------------|-------------------------------|
| POST  | `/api/user/register`          | –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è      |
| POST  | `/api/user/login`             | –õ–æ–≥–∏–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è            |
| POST  | `/api/user/orders`            | –ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞–∫–∞–∑–∞               |
| GET   | `/api/user/orders`            | –ò—Å—Ç–æ—Ä–∏—è –∑–∞–∫–∞–∑–æ–≤               |
| GET   | `/api/user/balance`           | –ë–∞–ª–∞–Ω—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è           |
| POST  | `/api/user/balance/withdraw`  | –°–ø–∏—Å–∞–Ω–∏–µ –±–∞–ª–ª–æ–≤               |
| GET   | `/api/user/withdrawals`       | –ò—Å—Ç–æ—Ä–∏—è –≤—ã–≤–æ–¥–æ–≤               |

---

## üß™ –ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤

### –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è

```http
POST /api/user/register
Content-Type: application/json

{
  "login": "alice",
  "password": "123456"
}
```

### –ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞–∫–∞–∑–∞

```http
POST /api/user/orders
Cookie: auth=<–ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–π user_id>

2377225624
```

---

## üìå –ó–∞–º–µ—Ç–∫–∏

- –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Å–æ–∑–¥–∞—ë—Ç—Å—è –∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏  
- –°—Ç–∞—Ç—É—Å—ã –∑–∞–∫–∞–∑–æ–≤ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –∏–∑ –≤–Ω–µ—à–Ω–µ–≥–æ —Å–µ—Ä–≤–∏—Å–∞  
- –ï—Å–ª–∏ –æ—á–µ—Ä–µ–¥—å –∑–∞–∫–∞–∑–æ–≤ –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∞ ‚Äî –∑–∞–∫–∞–∑—ã –Ω–µ —Ç–µ—Ä—è—é—Ç—Å—è, –æ–Ω–∏ –±—É–¥—É—Ç –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã –ø—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º –∑–∞–ø—É—Å–∫–µ  
- –ü—Ä–æ–µ–∫—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω —Å —Å–æ–±–ª—é–¥–µ–Ω–∏–µ–º —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π –¥–∏–ø–ª–æ–º–∞
